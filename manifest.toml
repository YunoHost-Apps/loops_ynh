#:schema https://raw.githubusercontent.com/YunoHost/apps/main/schemas/manifest.v2.schema.json

packaging_format = 2

id = "loops"
name = "Loops"
description.en = "Federated short video sharing platform"
description.fr = "Plateforme fédérée de partage de vidéos courtes"

version = "1.0.0-beta.4~ynh9"

maintainers = ["Papa Dragon"]

[upstream]
license = "AGPL-3.0-or-later"
website = "https://joinloops.org"
admindoc = "https://github.com/joinloops/loops-server/blob/main/INSTALLATION.md"
code = "https://github.com/joinloops/loops-server"

[integration]
yunohost = ">= 12.1.17"
helpers_version = "2.1"
architectures = "all"
multi_instance = true

ldap = false
sso = false

disk = "850M"
ram.build = "1500M"
ram.runtime = "350M"

[install]
    [install.domain]
    type = "domain"

    [install.init_main_permission]
    type = "group"
    default = "visitors"

    #[install.language]
    #ask.en = "Choose the application language"
    #ask.fr = "Choisissez la langue de l'application"
    #type = "select"
    #choices = ["fr", "en"]
    #default = "fr"

    [install.admin]
    type = "user"

    [install.password]
    help.en = "Set the admin password"
    help.fr = "Définissez le mot de passe de l'administrateur"
    type = "password"

    [install.s3_key_id]
    ask.en = "S3 key ID:"
    help.en = "Sets the key ID to connect to object storage"
    type = "string"

    [install.s3_key_secret]
    ask.en = "S3 key secret:"
    help.en = "Sets the key secret to connect to object storage"
    type = "string"

    [install.s3_region]
    ask.en = "S3 region:"
    help.en = "Skip this with other object storage providers"
    type = "string"
    default = "us-east-1"

    [install.s3_bucket]
    ask.en = "S3 bucket:"
    help.en = "Sets the name of the bucket"
    type = "string"

    [install.s3_path_style]
    ask.en = "Use path style endpoints for S3?"
    help.en = "Usually required by third-party providers"
    type = "boolean"

    [install.s3_endpoint]
    ask.en = "Custom S3 endpoint:"
    help.en = "Required when using a third-party object storage provider (https://<domain>)"
    type = "string"
    optional = true

    [install.mail_mailer]
    ask.en = "Choose a mail provider"
    ask.fr = "Choisissez un service pour l’envoi des courriels"
    type = "select"
    choices.smtp = "SMTP"
    choices.mailgun = "Mailgun"
    choices.postmark = "Postmark"
    choices.resend = "Resend"

    [install.smtp_host]
    ask.en = "SMTP Server Hostname"
    ask.fr = "Nom d'hôte du serveur SMTP"
    visible = "mailer == 'smtp'"
    default = "localhost"
    help.en = "The hostname of the SMTP server you want to use. Examples: mail.example.org, localhost"
    help.fr = "Le nom d'hôte du serveur SMTP que vous souhaitez utiliser. Exemples: mail.example.org, localhost"
    type = "string"

    [install.smtp_port]
    ask.en = "SMTP Port"
    ask.fr = "Port SMTP"
    visible = "mailer == 'smtp'"
    help.en = "Port to use to connect to the SMTP server (usually 587, but could be 465 or 2525 depending on your provider)"
    help.fr = "Port à utiliser pour se connecter au serveur SMTP (habituellement 587, peut aussi être 465 ou 2525 en fonction du service)"
    type = "string"
    default = "587"

    [install.smtp_username]
    ask.en = "SMTP Username"
    ask.fr = "Nom d'utilisateur SMTP"
    visible = "mailer == 'smtp'"
    help.en = "Username to use when authenticating with the SMTP server"
    help.fr = "Nom d'utilisateur à utiliser lors de l'authentification avec le serveur SMTP"
    type = "string"

    [install.smtp_password]
    ask.en = "SMTP Password"
    ask.fr = "Mot de passe SMTP"
    visible = "mailer == 'smtp'"
    help.en = "Password to use when authenticating with the SMTP server"
    help.fr = "Mot de passe à utiliser lors de l'authentification avec le serveur SMTP"
    type = "password"

    [install.smtp_encryption]
    ask.en = "SMTP Encrytion"
    ask.fr = "Type de chiffrement"
    visible = "mailer == 'smtp'"
    default = "localhost"
    help.en = "The hostname of the SMTP server you want to use. Examples: mail.example.org, localhost"
    help.fr = "Le nom d'hôte du serveur SMTP que vous souhaitez utiliser. Exemples: mail.example.org, localhost"
    type = "select"
    choices.tls = "TLS"
    choices.ssl = "SSL"

    [install.smtp_from]
    ask.en = "SMTP From Address"
    ask.fr = "Adresse d'expédition SMTP"
    visible = "mailer == 'smtp'"
    help.en = "From address for sent emails"
    help.fr = "L'adresse utilisée pour les e-mails envoyés"
    type = "email"
    example = "loops@__DOMAIN__"

    [install.mailgun_domain]
    ask.en = "Mailgun domain"
    ask.fr = "Domaine Mailgun"
    visible = "mailer == 'mailgun'"
    type = "string"

    [install.mailgun_secret]
    ask.en = "Mailgun secret"
    ask.fr = "Clé secrète Mailgun"
    visible = "mailer == 'mailgun'"
    type = "string"

    [install.postmark_token]
    ask.en = "Postmark token"
    ask.fr = "Token Postmark"
    visible = "mailer == 'postmark'"
    type = "string"

    [install.resend_key]
    ask.en = "Resend key"
    ask.fr = "Clé Resend"
    visible = "mailer == 'resend'"
    type = "string"

[resources]

    [resources.sources]

    [resources.sources.main]
    url = "https://github.com/joinloops/loops-server/archive/bb762273084be331e0ca758bd881164e4f5c9bed.zip"
    sha256 = "ca25a1ceda504da27154345410250423c642946b083ade69815eacfdb4c392c7"
    autoupdate.strategy = "latest_github_tag"
    autoupdate.version_regex = "^v(.*)$"

    [resources.system_user]
    allow_email = true

    [resources.install_dir]
    group = "www-data:r-x"

    [resources.data_dir]

    [resources.permissions]
    main.url = "/"

    [resources.apt]
    packages = "mariadb-server, libgd3, jpegoptim, optipng, pngquant, ffmpeg, imagemagick, php8.4-redis, php8.4-bcmath, php8.4-cli, php8.4-ctype, php8.4-exif, php8.4-gd, php8.4-iconv, php8.4-intl, php8.4-mbstring, php8.4-tokenizer, php8.4-xml, php8.4-pdo, php8.4-mysql, php8.4-zip, php8.4-fileinfo, php8.4-imagick, redis-server"

    [resources.database]
    type = "mysql"

    [resources.nodejs]
    version = "22"

    [resources.composer]
    version = "2.8.12"
