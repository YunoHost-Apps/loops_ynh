#:schema https://raw.githubusercontent.com/YunoHost/apps/main/schemas/manifest.v2.schema.json

packaging_format = 2

id = "loops"
name = "Loops"
description.en = "Federated short video sharing platform"
description.fr = "Plateforme fédérée de partage de vidéos courtes"

version = "1.0.0-beta.5~ynh7"

maintainers = ["Papa Dragon", "grossermensch"]

[upstream]
license = "AGPL-3.0-or-later"
website = "https://joinloops.org"
admindoc = "https://github.com/joinloops/loops-server/blob/main/INSTALLATION.md"
code = "https://github.com/joinloops/loops-server"

[integration]
yunohost = ">= 12.1.17"
helpers_version = "2.1"
architectures = "all"
multi_instance = true

ldap = false
sso = false

disk = "850M"
ram.build = "1500M"
ram.runtime = "350M"

[install]
    [install.domain]
    type = "domain"

    [install.init_main_permission]
    type = "group"
    default = "visitors"

    #[install.language]
    #ask.en = "Choose the application language"
    #ask.fr = "Choisissez la langue de l'application"
    #type = "select"
    #choices = ["fr", "en"]
    #default = "fr"

    [install.admin]
    type = "user"

    [install.password]
    help.en = "Set the admin password"
    help.fr = "Définissez le mot de passe de l'administrateur"
    type = "password"

    [install.s3_key_id]
    ask.en = "S3 key ID:"
    help.en = "Sets the key ID to connect to object storage"
    type = "string"

    [install.s3_key_secret]
    ask.en = "S3 key secret:"
    help.en = "Sets the key secret to connect to object storage"
    type = "string"

    [install.s3_region]
    ask.en = "S3 region:"
    help.en = "Skip this with other object storage providers"
    type = "string"
    default = "us-east-1"

    [install.s3_bucket]
    ask.en = "S3 bucket:"
    help.en = "Sets the name of the bucket"
    type = "string"

    [install.s3_path_style]
    ask.en = "Use path style endpoints for S3?"
    help.en = "Usually required by third-party providers"
    type = "boolean"

    [install.s3_endpoint]
    ask.en = "Custom S3 endpoint:"
    help.en = "Required when using a third-party object storage provider (https://<domain>)"
    type = "string"
    optional = true

[resources]

    [resources.sources]

    [resources.sources.main]
    url = "https://github.com/joinloops/loops-server/archive/ce24c70ce013322fea95f2666903a114d4c01e0f.zip"
    sha256 = "4a03790dc0f1182e1bcd54e9a5085e95046b004ce86cb6c83079e69a8858d84c"

    [resources.system_user]
    allow_email = true

    [resources.install_dir]
    group = "www-data:r-x"

    [resources.data_dir]

    [resources.permissions]
    main.url = "/"

    [resources.apt]
    packages = "mariadb-server, libgd3, jpegoptim, optipng, pngquant, ffmpeg, imagemagick, php8.4-redis, php8.4-bcmath, php8.4-cli, php8.4-ctype, php8.4-exif, php8.4-gd, php8.4-iconv, php8.4-intl, php8.4-mbstring, php8.4-tokenizer, php8.4-xml, php8.4-pdo, php8.4-mysql, php8.4-zip, php8.4-fileinfo, php8.4-imagick, redis-stack-server"

    [resources.database]
    type = "mysql"

    [resources.nodejs]
    version = "22"

    [resources.composer]
    version = "2.8.12"
